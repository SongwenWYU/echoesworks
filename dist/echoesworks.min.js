/*! echoesworks 15-11-2017 */

!function(e,t){"use strict";function n(e,t){var n=s.fn.rawGitConvert(e.data.codes[t]);s.get(n,function(e){document.querySelector("code").innerHTML=e,document.querySelector("slide").classList.remove("full"),document.querySelector("pre ").classList.remove("hidden")})}function i(e,t){var n,i=e.data.words[t];if(s.isObject(i)){var r=e.parser.parseTime(e.data.times)[t+1];if(e.time<r&&i.length>1){var a=i.length,o=(r-e.parser.parseTime(e.data.times)[t])/a*1e3,l=0;document.querySelector("words").innerHTML=i[l].word,n=setInterval(function(){++l-1===a?clearInterval(n):document.querySelector("words").innerHTML=i[l].word},o)}return n}document.querySelector("words").innerHTML=i}function r(){document.querySelector("slide").classList.add("full"),document.querySelector("words").classList.add("hidden")}function a(){document.querySelector("slide").classList.add("full"),document.querySelector("pre").classList.add("hidden")}var s=function(e){var t;t={element:"slide",auto:!1},void 0===e&&(console.log("Default Options is Empty, use default options..."),e={}),s.defaults(e,t),this.options=e,e.source&&(this.source=this.options.source),e.src&&(this.audioSrc=this.options.src),this.element=this.options.element,this.playing=!1,this.data=[],this.fps=10,this.time=0,this.audio=null,this.options.auto&&this.play(),this.init(),window.ew=this};s.prototype.init=function(){var e=this;this.audioSrc&&(this.audio=document.createElement("audio"),this.audio.src=this.audioSrc,this.audio.autoplay=this.options.auto),e.slide(),s.triggerEvent("ew:slide:init"),window.slide&&(window.slide.auto=e.options.auto,e.parser(),setInterval(function(){e.update()},1e3/this.fps))},s.prototype.stop=function(){console.log("total time:",this.time),this.playing=!1,this.time=0},s.prototype.pause=function(){this.playing=!1},s.prototype.play=function(){this.playing=!0},s.prototype.update=function(){this.playing&&(this.time+=1/this.fps),this.applyEchoes()},s.prototype.applyEchoes=function(){var e=this;if(e.parser.data&&void 0!==e.parser.data.codes&&e.parser.data.codes.length>0){e.data=e.parser.data;var t=e.parser.parseTime(e.data.times),s=window.slide.slide();parseFloat(e.time)>t[s]&&window.slide.auto&&(window.slide.next(),e.data.codes[s]&&window.slide.auto?n(e,s):a(),e.data.words[s]?i(e,s):r())}},s.version=s.VERSION="0.2.2",e.EchoesWorks=s,e.EW=s,s.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},s.isFunction=function(e){return"function"==typeof e||!1},s.defaults=function(e){if(!s.isObject(e))return e;for(var t=1,n=arguments.length;t<n;t++){var i=arguments[t];for(var r in i)void 0===e[r]&&(e[r]=i[r])}return e},s.extend=function(e){if(!s.isObject(e))return e;for(var t,n,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(n in t)hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},s.triggerEvent=function(e){var t=document.createEvent("Event");t.initEvent(e,!0,!0),document.dispatchEvent(t)},s.forEach=function(e,t,n){if("[object Object]"===Object.prototype.toString.call(e))for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(n,e[i],i,e);else for(var r=0,a=e.length;r<a;r++)t.call(n,e[r],r,e)},s.get=function(e,t){s.send(e,"GET",t)},s.load=function(e,t){s.send(e,"GET",t)},s.post=function(e,t,n){s.send(e,"POST",n,t)},s.send=function(e,t,n,i){i=i||null;var r=new XMLHttpRequest;n instanceof Function&&(r.onreadystatechange=function(){4!==r.readyState||200!==r.status&&0!==r.status||n(r.responseText)}),r.open(t,e,!0),r.send(i)};s.prototype=s.extend(s.prototype,{slide:function(){var e=this.options.element,t=1===e.nodeType?e:document.querySelector(e),n=[].filter.call(t.children,function(e){return"SCRIPT"!==e.nodeName}),i=n[0],r={},a=function(e,t){if(n[e]){i.className=i.className.replace(new RegExp("active(\\s|$)","g")," ").trim(),i.classList.add("past"),l("deactivate",c(i,t)),(i=n[e]).className="active";var r=parseInt(e,10)===n.length-1;(0===parseInt(e,10)||r)&&i.classList.add("specify"),window.bar.go(100*(e+1)/n.length),s(e),localStorage.setItem("echoesworks",e),l("activate",c(i,t))}},s=function(e){window.location.hash="#/"+e},o=function(e,t){var r=n.indexOf(i)+e;l(e>0?"next":"prev",c(i,t))&&a(r,t)},l=function(e,t){return(r[e]||[]).reduce(function(e,n){return e&&!1!==n(t)},!0)},c=function(e,t){return t=t||{},t.index=n.indexOf(e),t.slide=e,t},d={on:function(e,t){return(r[e]||(r[e]=[])).push(t),function(){r[e]=r[e].filter(function(e){return e!==t})}},fire:l,slide:function(e,t){if(!arguments.length)return n.indexOf(i);l("slide",c(n[e],t))&&a(e,t)},next:o.bind(null,1),prev:o.bind(null,-1),parent:t,slides:n,auto:!1};return function(){var e=window.location.hash.replace(/#|\//gi,"");a(e>0?e:0)}(),window.slide=d,d}});var o=function(){var e=this;e.source&&o.init(e.source)};o.data=[],o.init=function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4!==t.readyState||200!==t.status&&0!==t.status||o.parse(JSON.parse(t.responseText))},t.open("GET",e,!0),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.send()},o.parse=function(e){var t,n=[],i=[],r=[];return e.forEach(function(e){n.push(e.time),i.push(e.code),r.push(e.word)}),t={times:n,codes:i,words:r},o.data=t,t},o.parseTime=function(e){var t=/\[\d{2}:\d{2}.\d{2}\]/g,n=[];return e.forEach(function(e){var i=e.slice(1,-1).split(":"),r=e.replace(t,"");n.push([60*parseFloat(i[0])+parseFloat(i[1]),r][0])}),n},s.prototype=s.extend(s.prototype,{parser:o});var l={regexobject:{headline:/^(\#{1,6})([^\#\n]+)$/m,pre:/\s\`\`\`(\w+)\n?[^`]+\`\`\`/g,code:/\s\`\`\`\n?([^`]+)\`\`\`/g,hr:/^(?:([\*\-_] ?)+)\1\1$/gm,lists:/^((\s*((\*|\-)|\d(\.|\))) [^\n]+)\n)+/gm,bolditalic:/(?:([\*_~]{1,3}))([^\*_~\n]+[^\*_~\s])\1/g,links:/!?\[([^\]<>]+)\]\(([^ \)<>]+)( "[^\(\)\"]+")?\)/g,reflinks:/\[([^\]]+)\]\[([^\]]+)\]/g,smlinks:/\@([a-z0-9]{3,})\@(t|gh|fb|gp|adn)/gi,mail:/<(([a-z0-9_\-\.])+\@([a-z0-9_\-\.])+\.([a-z]{2,7}))>/gim,tables:/\n(([^|\n]+ *\| *)+([^|\n]+\n))((:?\-+:?\|)+(:?\-+:?)*\n)((([^|\n]+ *\| *)+([^|\n]+)\n)+)/g,include:/[\[<]include (\S+) from (https?:\/\/[a-z0-9\.\-]+\.[a-z]{2,9}[a-z0-9\.\-\?\&\/]+)[\]>]/gi,url:/<([a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[\-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?)>/g},codeHandler:function(e,t){var n,i="";return null!==(n=this.regexobject.pre.exec(e))&&(i=n[1]),t.replace(e[0],'<pre><code class="'+i+'">\n'+l.htmlEncode(e[1]).replace(i+"\n","").replace(/\n/gm,"<br/>").replace(/\ /gm,"&nbsp;")+"</code></pre>\n")},headlineHandler:function(e,t){var n=e[1].length;return t.replace(e[0],"<h"+n+">"+e[2]+"</h"+n+">\n")},linksHandler:function(e,t,n){return t="!"===e[0].substr(0,1)?t.replace(e[0],'<img src="'+e[2]+'" alt="'+e[1]+'" title="'+e[1]+'" />\n'):t.replace(e[0],"<a "+l.mmdCSSclass(e[2],n)+'href="'+e[2]+'">'+e[1]+"</a>\n")},mailHandler:function(e,t){return t.replace(e[0],'<a href="mailto:'+e[1]+'">'+e[1]+"</a>")},hrHandler:function(e,t){return t.replace(e[0],"\n<hr/>\n")},urlHandler:function(e,t,n){var i=e[1];return-1===i.indexOf("://")&&(i="http://"+i),t.replace(e[0],"<a "+l.mmdCSSclass(i,n)+'href="'+i+'">'+i.replace(/(https:\/\/|http:\/\/|mailto:|ftp:\/\/)/gim,"")+"</a>")},refLinksHandler:function(e,t,n,i){return e.replace(t[0],"<a "+l.mmdCSSclass(n[1],i)+'href="'+n[1]+'">'+t[1]+"</a>")},smlinksHandler:function(e,t,n){var i="";switch(e[2]){case"t":i="https://twitter.com/"+e[1];break;case"gh":i="https://github.com/"+e[1];break;case"fb":i="https://www.facebook.com/"+e[1];break;case"gp":i="https://plus.google.com/+"+e[1]}return t.replace(e[0],"<a "+l.mmdCSSclass(i,n)+'href="'+i+'">'+e[1]+"</a>")},boldItalicHandler:function(e,t){var n=[];if("~~"===e[1])t=t.replace(e[0],"<del>"+e[2]+"</del>");else{switch(e[1].length){case 1:n=["<i>","</i>"];break;case 2:n=["<b>","</b>"];break;case 3:n=["<i><b>","</b></i>"]}t=t.replace(e[0],n[0]+e[2]+n[1])}return t},tableHandlerHelper:function(e,t,n){var i;for(i=0;i<e.length;i++)t.length<=i?t.push(0):":"===t[i].trimRight().slice(-1)&&!0!==n?":"===t[i][0]?t[i]=3:t[i]=2:!0!==n&&":"===t[i][0]?t[i]=1:t[i]=0},tableHandler:function(e,t,n,i,r){var a,s;if(0!==(s=e[t].split("|"))[0].length){for(;n.length<s.length;)n.push(0);for(i+="<tr>",a=0;a<s.length;a++)i+=r[n[a]]+s[a].trim()+"</td>";i+="</tr>\n"}return{helper2:s,replaceStr:i}},tablesHandler:function(e,t,n){var i,r,a,s,o,l;for(i="<table><tr>",a=e[1].split("|"),s=e[4].split("|"),this.tableHandlerHelper(a,s,n),r=["<th>",'<th align="left">','<th align="right">','<th align="center">'],l=0;l<a.length;l++)i+=r[s[l]]+a[l].trim()+"</th>";for(i+="</tr>",r=["<td>",'<td align="left">','<td align="right">','<td align="center">'],o=e[7].split("\n"),l=0;l<o.length;l++){var c=this.tableHandler(o,l,s,i,r);c.helper2,i=c.replaceStr}return i+="</table>",t.replace(e[0],i)},listHandlerStart:function(e,t){return"*"===e[0].trim().substr(0,1)||"-"===e[0].trim().substr(0,1)?"<ul>":"<ol>"},listsHandlerEnd:function(e,t){return"*"===e[0].trim().substr(0,1)||"-"===e[0].trim().substr(0,1)?t+="</ul>":t+="</ol>",t},listsHandlerSub:function(e,t,n){return"*"===e[0].trim().substr(0,1)||"-"===e[0].trim().substr(0,1)?(t+="<ul>",n.push("</ul>")):(t+="<ol>",n.push("</ol>")),t},listHandler:function(e,t,n,i,r,a){var s=!1;for(void 0===e[2]||0===e[2].length?t=0:(!1===s&&(s=e[2].replace(/\t/,"    ").length),t=Math.round(e[2].replace(/\t/,"    ").length/s));n>t;)i+=r.pop(),n--,a--;for(;n<t;)i=this.listsHandlerSub(e,i,r),n++,a++;return i+="<li>"+e[6]+"</li>\n",{nstatus:t,status:n,replaceStr:i,casca:a}},listsHandler:function(e,t){var n,i,r,a,s,o=[],l=0,c=0;for(a=this.listHandlerStart(e,a),n=e[0].split("\n"),s=0;s<n.length;s++)if(null!==(i=/^((\s*)((\*|\-)|\d(\.|\))) ([^\n]+))/.exec(n[s]))){var d=this.listHandler(i,r,l,a,o,c);r=d.nstatus,l=d.status,a=d.replaceStr,c=d.casca}for(;c>0;)a+="</ul>",c--;return a=this.listsHandlerEnd(e,a),t.replace(e[0],a+"\n")},listStrict:function(e,t){return!0!==e&&(t.lists=/^((\s*(\*|\d\.) [^\n]+)\n)+/gm),t.lists},removeRefLinks:function(e,t){var n;for(n=0;n<e.length;n++)t=t.replace(e[n],"");return t},parse:function(e,t){var n,i,r,a=[],s=this,o=l.regexobject;for(o.lists=this.listStrict(t,o),e="\n"+e+"\n",["code","headline","lists","tables","links","mail","url","smlinks","hr"].forEach(function(n){for(;null!==(i=o[n].exec(e));)e=s[n+"Handler"].apply(s,[i,e,t])}),r=0;r<3;r++)for(;null!==(i=o.bolditalic.exec(e));)e=this.boldItalicHandler(i,e);for(;null!==(i=o.reflinks.exec(e));)null!==(n=new RegExp("\\["+i[2]+"\\]: ?([^ \n]+)","gi").exec(e))&&(e=this.refLinksHandler(e,i,n,t),a.push(n[0]));return(e=this.removeRefLinks(a,e)).replace(/ {2,}[\n]{1,}/gim,"<br/><br/>")},htmlEncode:function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML},mmdCSSclass:function(e,t){var n;return-1!==e.indexOf("/")&&!0!==t?(n=e.split("/"),'class="mmd_'+(n=0===n[1].length?n[2].split("."):n[0].split("."))[n.length-2].replace(/[^\w\d]/g,"")+n[n.length-1]+'" '):""}};s.md=l;var c=function(){var e=document.querySelectorAll(".header h1");s.forEach(e,function(t,n){var i=document.createElement("h1"),r=t.parentNode.parentNode;i.innerHTML=t.innerHTML,r.insertBefore(i,r.firstChild),t.parentNode.removeChild(e[n])})},d=function(e){var t=document.getElementsByTagName("img");return s.forEach(t,function(e){var t=e.src,n=e.title;"background"===n?d.backgroundHandler(e,t,n):("left"===n?d.directionHandler(e,n,t,"right"):"right"===n&&d.directionHandler(e,n,t,"left"),c())}),d.removeImages(),e};d.directionHandler=function(e,t,n,i){var r=e.parentNode,a=document.createElement("div");a.innerHTML=r.innerHTML,a.className=i,a.className+=" header",r.innerHTML="",r.appendChild(a);var s=document.createElement("div");r.appendChild(s),s.classList.add("image-"+t),s.width=200,s.style.background="url('"+n+"') no-repeat"},d.backgroundHandler=function(e,t,n){e.parentNode.style.backgroundImage="url('"+t+"')",e.parentNode.classList.add(n)},d.removeImages=function(){var e,t=document.getElementsByTagName("img");for(e=t.length-1;e>=0;e--)t[e].parentNode.removeChild(t[e])},s.imageHandler=d;var u,h,p,f,m,g,v={width:"100%",height:"4px",zIndex:9999,bottom:"0"},w={width:0,height:"100%",clear:"both",transition:"height .3s"};u=function(e,t){var n;for(n in t)e.style[n]=t[n];e.style.float="left"},f=function(){var e=this,t=this.width-this.here;t<.1&&t>-.1?(m.call(this,this.here),this.moving=!1,100==this.width&&(this.el.style.height=0,setTimeout(function(){e.cont.el.removeChild(e.el)},300))):(m.call(this,this.width-t/4),setTimeout(function(){e.go()},16))},m=function(e){this.width=e,this.el.style.width=this.width+"%"},g=function(){var e=new h(this);this.bars.unshift(e)},(h=function(e){this.el=document.createElement("div"),this.el.style.backgroundColor="#F44336",this.width=0,this.here=0,this.moving=!1,this.cont=e,u(this.el,w),e.el.appendChild(this.el)}).prototype.go=function(e){e?(this.here=e,this.moving||(this.moving=!0,f.call(this))):this.moving&&f.call(this)},(p=function(){this.bars=[],this.el=document.createElement("div"),this.el.className="bar",u(this.el,v),this.el.style.position="fixed",document.getElementsByTagName("body")[0].appendChild(this.el),g.call(this)}).prototype.go=function(e){this.bars[0].go(e),100==e&&g.call(this)};var b=new p;window.bar=b,s.bar=b;var y={};s.fn=y;var E={rawGitConvert:function(e){var t=e.replace("github.com","rawgit.com");return t=t.replace("raw.githubusercontent.com","rawgit.com")}};s.fn=s.extend(s.fn,E)}(this),function(e){"use strict";function t(){window.slide.auto=!1,window.ew&&window.ew.audio&&window.ew.audio.pause()}function n(){EchoesWorks.forEach(r,function(e){var n,i=window.screen.width/3,r=window.screen.height/3;e.addEventListener("touchstart",function(e){a={x:e.touches[0].pageX,y:e.touches[0].pageY},s=!0}),e.addEventListener("touchend",function(){s=!1}),e.addEventListener("touchmove",function(e){if(s){e.preventDefault();var o=(n={x:e.touches[0].pageX-a.x,y:e.touches[0].pageY-a.y}).x>0&&n.x>i,l=n.y>0&&n.y>r,c=n.x<0&&Math.abs(n.x)>i,d=n.y<0&&Math.abs(n.y)>r;c||l?(window.slide.next(),s=!1):(o||d)&&(window.slide.prev(),s=!1)}t()})})}function i(){function e(){window.slide.slide(parseInt(localStorage.getItem("echoesworks"),10))}window.addEventListener?window.addEventListener("storage",e,!1):window.attachEvent("onstorage",e)}var r,a,s,o=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints};e.addEventListener("ew:slide:init",function(){r=e.getElementsByTagName("section"),i(),r&&o&&window.slide&&n(),e.addEventListener("keydown",function(e){t();var n=e.keyCode;(9===n||n>=32&&n<=34||n>=37&&n<=40)&&e.preventDefault()},!1),e.addEventListener("keyup",function(e){var t=e.keyCode;if(9===t||t>=32&&t<=34||t>=37&&t<=40){switch(t){case 33:case 37:case 38:window.slide.prev();break;case 9:case 32:case 34:case 39:case 40:window.slide.next()}e.preventDefault()}})})}(document);