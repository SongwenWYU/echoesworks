/*! echoesworks 03-06-2015 */
!function(a,b){"use strict";var c=function(){return!0};c.VERSION="0.0.0",a.EchoesWorks=c,a.EW=c;var d={regexobject:{headline:/^(\#{1,6})([^\#\n]+)$/m,code:/\s\`\`\`\n?([^`]+)\`\`\`/g,hr:/^(?:([\*\-_] ?)+)\1\1$/gm,lists:/^((\s*((\*|\-)|\d(\.|\))) [^\n]+)\n)+/gm,bolditalic:/(?:([\*_~]{1,3}))([^\*_~\n]+[^\*_~\s])\1/g,links:/!?\[([^\]<>]+)\]\(([^ \)<>]+)( "[^\(\)\"]+")?\)/g,reflinks:/\[([^\]]+)\]\[([^\]]+)\]/g,smlinks:/\@([a-z0-9]{3,})\@(t|gh|fb|gp|adn)/gi,mail:/<(([a-z0-9_\-\.])+\@([a-z0-9_\-\.])+\.([a-z]{2,7}))>/gim,tables:/\n(([^|\n]+ *\| *)+([^|\n]+\n))((:?\-+:?\|)+(:?\-+:?)*\n)((([^|\n]+ *\| *)+([^|\n]+)\n)+)/g,include:/[\[<]include (\S+) from (https?:\/\/[a-z0-9\.\-]+\.[a-z]{2,9}[a-z0-9\.\-\?\&\/]+)[\]>]/gi,url:/<([a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[\-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?)>/g},parse:function(a,c){var e,f,g,h,i,j,k,l,m,n,o,p=0,q=[],r=0,s=0,t=0;for(a="\n"+a+"\n",c!==!0&&(d.regexobject.lists=/^((\s*(\*|\d\.) [^\n]+)\n)+/gm);null!==(o=d.regexobject.code.exec(a));)a=a.replace(o[0],"<code>\n"+d.htmlEncode(o[1]).replace(/\n/gm,"<br/>").replace(/\ /gm,"&nbsp;")+"</code>\n");for(;null!==(o=d.regexobject.headline.exec(a));)m=o[1].length,a=a.replace(o[0],"<h"+m+">"+o[2]+"</h"+m+">\n");for(;null!==(o=d.regexobject.lists.exec(a));){for(r=0,n="*"===o[0].trim().substr(0,1)||"-"===o[0].trim().substr(0,1)?"<ul>":"<ol>",j=o[0].split("\n"),k=[],f=0,i=!1,s=0;s<j.length;s++)if(null!==(e=/^((\s*)((\*|\-)|\d(\.|\))) ([^\n]+))/.exec(j[s]))){for(e[2]===b||0===e[2].length?p=0:(i===!1&&(i=e[2].replace(/\t/,"    ").length),p=Math.round(e[2].replace(/\t/,"    ").length/i));f>p;)n+=k.pop(),f--,r--;for(;p>f;)"*"===e[0].trim().substr(0,1)||"-"===e[0].trim().substr(0,1)?(n+="<ul>",k.push("</ul>")):(n+="<ol>",k.push("</ol>")),f++,r++;n+="<li>"+e[6]+"</li>\n"}for(;r>0;)n+="</ul>",r--;n+="*"===o[0].trim().substr(0,1)||"-"===o[0].trim().substr(0,1)?"</ul>":"</ol>",a=a.replace(o[0],n+"\n")}for(;null!==(o=d.regexobject.tables.exec(a));){for(n="<table><tr>",j=o[1].split("|"),h=o[4].split("|"),s=0;s<j.length;s++)h.length<=s?h.push(0):":"===h[s].trimRight().slice(-1)&&c!==!0?":"===h[s][0]?h[s]=3:h[s]=2:c!==!0&&":"===h[s][0]?h[s]=1:h[s]=0;for(g=["<th>",'<th align="left">','<th align="right">','<th align="center">'],s=0;s<j.length;s++)n+=g[h[s]]+j[s].trim()+"</th>";for(n+="</tr>",g=["<td>",'<td align="left">','<td align="right">','<td align="center">'],k=o[7].split("\n"),s=0;s<k.length;s++)if(l=k[s].split("|"),0!==l[0].length){for(;h.length<l.length;)h.push(0);for(n+="<tr>",t=0;t<l.length;t++)n+=g[h[t]]+l[t].trim()+"</td>";n+="</tr>\n"}n+="</table>",a=a.replace(o[0],n)}for(s=0;3>s;s++)for(;null!==(o=d.regexobject.bolditalic.exec(a));)if(n=[],"~~"===o[1])a=a.replace(o[0],"<del>"+o[2]+"</del>");else{switch(o[1].length){case 1:n=["<i>","</i>"];break;case 2:n=["<b>","</b>"];break;case 3:n=["<i><b>","</b></i>"]}a=a.replace(o[0],n[0]+o[2]+n[1])}for(;null!==(o=d.regexobject.links.exec(a));)a="!"===o[0].substr(0,1)?a.replace(o[0],'<img src="'+o[2]+'" alt="'+o[1]+'" title="'+o[1]+'" />\n'):a.replace(o[0],"<a "+d.mmdCSSclass(o[2],c)+'href="'+o[2]+'">'+o[1]+"</a>\n");for(;null!==(o=d.regexobject.mail.exec(a));)a=a.replace(o[0],'<a href="mailto:'+o[1]+'">'+o[1]+"</a>");for(;null!==(o=d.regexobject.url.exec(a));)n=o[1],-1===n.indexOf("://")&&(n="http://"+n),a=a.replace(o[0],"<a "+d.mmdCSSclass(n,c)+'href="'+n+'">'+n.replace(/(https:\/\/|http:\/\/|mailto:|ftp:\/\/)/gim,"")+"</a>");for(;null!==(o=d.regexobject.reflinks.exec(a));)k=new RegExp("\\["+o[2]+"\\]: ?([^ \n]+)","gi"),null!==(j=k.exec(a))&&(a=a.replace(o[0],"<a "+d.mmdCSSclass(j[1],c)+'href="'+j[1]+'">'+o[1]+"</a>"),q.push(j[0]));for(s=0;s<q.length;s++)a=a.replace(q[s],"");for(;null!==(o=d.regexobject.smlinks.exec(a));){switch(o[2]){case"t":n="https://twitter.com/"+o[1];break;case"gh":n="https://github.com/"+o[1];break;case"fb":n="https://www.facebook.com/"+o[1];break;case"gp":n="https://plus.google.com/+"+o[1]}a=a.replace(o[0],"<a "+d.mmdCSSclass(n,c)+'href="'+n+'">'+o[1]+"</a>")}for(;null!==(o=d.regexobject.hr.exec(a));)a=a.replace(o[0],"\n<hr/>\n");return a=a.replace(/ {2,}[\n]{1,}/gim,"<br/><br/>")},htmlEncode:function(a){var c=document.createElement("div");return c.appendChild(document.createTextNode(a)),a=c.innerHTML,c=b,a},mmdCSSclass:function(a,b){var c;return-1!==a.indexOf("/")&&b!==!0?(c=a.split("/"),c=0===c[1].length?c[2].split("."):c[0].split("."),'class="mmd_'+c[c.length-2].replace(/[^\w\d]/g,"")+c[c.length-1]+'" '):""}};c.md=d}(this);